{% extends "layout.html" %}

{% block title %}
    Log In
{% endblock %}

{% block content %}
    <form action="/login" method="post">
        <div class="mb-3">
            <input autocomplete="off" autofocus class="form-control mx-auto w-auto" name="username" placeholder="Username" type="text">
        </div>
        <div class="mb-3">
            <input class="form-control mx-auto w-auto" name="password" placeholder="Password" type="password">
        </div>
            <div class="d-flex justify-content-center">
                <button class="btn btn-primary" type="submit">Log In</button>
            </div>
    </form>
    <div class="mt-3 text-center">
        <a href="/register" class="btn btn-link">¿No tienes cuenta? Regístrate aquí</a>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        // Assuming you have jQuery included
        $("form").submit(function(event) {
            // Prevent the form from submitting immediately
            event.preventDefault();

            // Perform your AJAX login here
            $.ajax({
                type: "POST",
                url: "/login",
                data: $(this).serialize(),
                success: function(response) {
                    // On success, you can set the session variables using JavaScript
                    sessionStorage.setItem("user_id", response.user_id);
                    sessionStorage.setItem("rol", response.rol);

                    // Redirect or perform other actions
                    window.location.href = "/dashboard"; // Change to your desired redirect
                },
                error: function() {
                    // Handle login error
                    alert("Error al iniciar sesión. Por favor, verifica tus credenciales.");
                }
            });
        });
    </script>
{% endblock %}
